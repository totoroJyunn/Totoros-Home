name: Update README contributors preview

on:
  push:
    paths:
      - CONTRIBUTORS.md

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Update contributors section in README
        run: |
          CONTRIBUTORS=$(grep '^-' CONTRIBUTORS.md | tail -n 5)

          awk '
          BEGIN {in_block=0}
          /<!-- CONTRIBUTORS_START -->/ {
            print;
            in_block=1;
            print CONTRIBUTORS;
            next
          }
          /<!-- CONTRIBUTORS_END -->/ {
            in_block=0;
            print;
            next
          }
          !in_block {print}
          ' CONTRIBUTORS="$CONTRIBUTORS" README.md > README.tmp

          mv README.tmp README.md

      - name: Commit changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add README.md
          git commit -m "Auto-update contributors preview" || exit 0
          git push